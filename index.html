<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BattleLegends 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial,sans-serif; }
#menu, #options { position:fixed; top:0; left:0; width:100%; height:100%; background:#111; color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10; }
button { padding:15px 30px; margin:10px; font-size:18px; cursor:pointer; }
#characters { display:flex; flex-wrap:wrap; justify-content:center; max-width:800px; }
#hud { position:fixed; top:10px; left:10px; color:#0f0; z-index:10; display:none; }
#crosshair { position:fixed; top:50%; left:50%; width:20px; height:20px; margin:-10px 0 0 -10px; pointer-events:none; display:none; }
#crosshair::before,#crosshair::after{content:'';position:absolute;background:#fff;}
#crosshair::before{left:9px; top:0; width:2px; height:20px;}
#crosshair::after{top:9px; left:0; width:20px; height:2px;}
</style>
</head>
<body>

<!-- Menus -->
<div id="menu">
  <h1>ðŸ”¥ BattleLegends 3D</h1>
  <button id="playBtn">Play</button>
  <button id="optionsBtn">Options</button>
</div>

<div id="options" style="display:none;">
  <h2>Select Character</h2>
  <div id="characters"></div>
  <button id="backBtn">Back</button>
</div>

<!-- HUD -->
<div id="hud">
  <h3>Health: <span id="health">500</span></h3>
  <p>WASD Move | Mouse Look | Click Shoot | C = Change Camera</p>
</div>

<div id="crosshair"></div>

<!-- Three.js and Loader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* ----------------- MENU & CHARACTER SELECTION ----------------- */
const menu = document.getElementById('menu');
const optionsMenu = document.getElementById('options');
const playBtn = document.getElementById('playBtn');
const optionsBtn = document.getElementById('optionsBtn');
const backBtn = document.getElementById('backBtn');
const charactersDiv = document.getElementById('characters');
let selectedCharacter = null;
let selectedPowers = [];

// Define multiple characters with ID and powers
const characters = [
  {id:1, name:'Soldier', color:0x00ff00, powers:['None','Shield','Extra Damage']},
  {id:2, name:'Ninja', color:0x0000ff, powers:['Fast','Double Jump','Invisibility']},
  {id:3, name:'Tank', color:0xff0000, powers:['Shield','Slow','High Health']},
  {id:4, name:'Sniper', color:0xffff00, powers:['Long Range','Fast Reload','Camouflage']},
  {id:5, name:'Pyro', color:0xff6600, powers:['Fire Damage','Speed','Shield']},
];

// Populate character buttons
characters.forEach(c=>{
  const btn = document.createElement('button');
  btn.textContent = `${c.name} (ID: ${c.id})`;
  btn.style.background = '#222'; btn.style.color='#fff';
  btn.onclick = ()=>{
    selectedCharacter = c;
    // Let player select powers
    selectedPowers = [];
    const power = prompt(`Select one power for ${c.name}:\n${c.powers.join(', ')}`, c.powers[0]);
    if(power && c.powers.includes(power)) selectedPowers.push(power);
    alert(`Selected ${c.name} with power: ${selectedPowers.join(', ')}`);
  };
  charactersDiv.appendChild(btn);
});

// Menu button actions
optionsBtn.onclick=()=>{menu.style.display='none'; optionsMenu.style.display='flex';};
backBtn.onclick=()=>{optionsMenu.style.display='none'; menu.style.display='flex';};
playBtn.onclick=()=>{
  if(!selectedCharacter){ alert('Select a character first in Options!'); return; }
  menu.style.display='none';
  optionsMenu.style.display='none';
  document.getElementById('hud').style.display='block';
  document.getElementById('crosshair').style.display='block';
  startGame();
};

/* ----------------- GAME START ----------------- */
function startGame(){

let health = 500;
function updateHealth(val){ health = val; document.getElementById('health').innerText = health; }

/* SCENE */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
scene.fog = new THREE.Fog(0x87CEEB,50,400);

/* CAMERA & RENDERER */
const camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,500);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* CONTROLS */
const controls = new THREE.PointerLockControls(camera,document.body);
document.body.addEventListener('click',()=>controls.lock());
scene.add(controls.getObject());

/* LIGHT */
const hemiLight = new THREE.HemisphereLight(0xffffff,0x444444,0.6); scene.add(hemiLight);
const dirLight = new THREE.DirectionalLight(0xffffff,1); dirLight.position.set(10,20,10); dirLight.castShadow=true; scene.add(dirLight);

/* GROUND */
const ground = new THREE.Mesh(new THREE.PlaneGeometry(400,400), new THREE.MeshStandardMaterial({color:0x228B22}));
ground.rotation.x=-Math.PI/2; ground.receiveShadow=true; scene.add(ground);

/* BOXES / OBSTACLES */
const boxes = [];
for(let i=0;i<50;i++){
  const box = new THREE.Mesh(new THREE.BoxGeometry(3,Math.random()*6+2,3), new THREE.MeshStandardMaterial({color:0x555555}));
  box.position.set((Math.random()-0.5)*150, box.geometry.parameters.height/2,(Math.random()-0.5)*150);
  scene.add(box); boxes.push(box);
}

/* PLAYER MODEL (GLTF placeholder) */
let player, mixer;
const loader = new THREE.GLTFLoader();
loader.load('https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF/Avocado.gltf',function(gltf){
  player = gltf.scene;
  player.scale.set(2,2,2);
  player.position.set(0,0,0);
  scene.add(player);
  mixer = new THREE.AnimationMixer(player);
  if(gltf.animations.length>0) mixer.clipAction(gltf.animations[0]).play();
});

/* CAMERA MODE */
let cameraMode='FPS';
document.addEventListener('keydown',e=>{ if(e.code==='KeyC'){ cameraMode=cameraMode==='FPS'?'TPS':'FPS'; }});

/* MOVEMENT */
const keys = {}; document.addEventListener('keydown',e=>keys[e.code]=true);
document.addEventListener('keyup',e=>keys[e.code]=false);
const speed = selectedPowers.includes('Fast')?10:6;
const clock = new THREE.Clock();

/* SHOOTING */
document.addEventListener('mousedown',()=>{
  const bullet = new THREE.Mesh(new THREE.SphereGeometry(0.05,8,8), new THREE.MeshBasicMaterial({color:0xff0000}));
  bullet.position.copy(camera.getWorldPosition(new THREE.Vector3())); scene.add(bullet);
  const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
  function moveBullet(){ bullet.position.add(dir.clone().multiplyScalar(1.5)); if(bullet.position.length()<300){ requestAnimationFrame(moveBullet); } else scene.remove(bullet);}
  moveBullet();
});

/* AI BOTS */
const bots=[];
for(let i=0;i<5;i++){
  const bot = new THREE.Mesh(new THREE.BoxGeometry(1,1.8,1), new THREE.MeshStandardMaterial({color:0xff0000}));
  bot.position.set((Math.random()-0.5)*100,0.9,(Math.random()-0.5)*100);
  scene.add(bot);
  bots.push({mesh:bot,dir:new THREE.Vector3(Math.random()-0.5,0,Math.random()-0.5).normalize()});
}

/* ANIMATE */
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();

  // Player Movement
  let vel = new THREE.Vector3();
  if(keys['KeyW']) vel.z -= speed*delta;
  if(keys['KeyS']) vel.z += speed*delta;
  if(keys['KeyA']) vel.x -= speed*delta;
  if(keys['KeyD']) vel.x += speed*delta;
  controls.moveRight(vel.x); controls.moveForward(vel.z);

  // Camera Mode
  if(player){
    if(cameraMode==='TPS'){
      camera.position.copy(player.position.clone().add(new THREE.Vector3(0,5,10)));
      camera.lookAt(player.position);
    } else { camera.position.copy(player.position.clone().add(new THREE.Vector3(0,1.6,0))); }
  }

  // AI Bot Movement
  bots.forEach(b=>{ b.mesh.position.add(b.dir.clone().multiplyScalar(1.5*delta));
    if(Math.random()<0.01) b.dir.set(Math.random()-0.5,0,Math.random()-0.5).normalize();
  });

  if(mixer) mixer.update(delta);
  renderer.render(scene,camera);
}
animate();

/* RESIZE */
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

} // end startGame
</script>
</body>
</html>
